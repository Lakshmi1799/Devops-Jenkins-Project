# [Devops-Jenkins-Project](https://github.com/Lakshmi1799/Devops-Jenkins-Project.git)

> A devops jenkins project with the use of jenkins, ansible, kubernetes, tomcat, aws  
> Monolithic architechture is used in this project

![image](https://github.com/user-attachments/assets/7a420473-2229-43f5-a6c8-25286ab45933)


## Overview

### Creating the Infra using Terraform

> Inorder to create the infra such as ec2 instances and vpc, we can run the terraform code.
> Terraform modules is used to create infra.
> 3 tier architecture is built in AWS Cloud.

```tf
 provider "aws" {
 region = var.inst_region
 }
 module "ec2" {
 source = "./module/ec2"
 }
 module "vpc" {
 source = "./module/vpc"
 }
```

To provision the infrastructure using terraform,

```sh
> terraform init
> terraform plan 
> terraform apply -auto-approve
> terraform output
```

### Servers are configured using ansible

- softwares are installed on web, app and db servers using playbooks.
- Also roles are being created and executed when required

### Jenkins Installation

- Go into aws console and server
- We can use `MobaXterm` or PuTTy to connect to the server, but we don't need to convert the key when using with `MobaXTerm`

<details>
  <summary>Jenkins Architecture</summary>
  <img src="./docs/8.png"/>
</details>

```sh
> sudo su - # be the root user
> java -version # we need 1.8
> yum remove java-1.7.0* # remove 1.7
> yum install java-1.8*
```

- We need to download LTS (Long Term Support) version of redhat and fedora version.
- Access jenkins in the browser

```sh
http://YOUR-SERVER-PUBLIC-IP:8080
> cat /var/lib/jenkins/secrets/initialAdminPassword # to find the autogenerated password
```

- Don't need to install jenkins plugins for now. Close it we will install it based on necessities.
- Start using jenkins.
- Change the admin password, `admin` > `configure` > `password` > `apply` 
- Manage jenkins > Global tool configuration > Add JDK
  - Name: `JAVA_HOME`
  - JAVA_HOME: `paste the path`
- `apply` > `save`

```sh
> ssh -o IdentitiesOnly=yes -i key.pem ec2-user@x.x.x.x
> echo $JAVA_HOME #copy the path
```

### Creating a Job

- Go to `New Item` > select `Pipeline Jobs` > Give it a name

### Writing pipeline script

- The pipeline script can be found in [pipeline script](https://github.com/Lakshmi1799/Devops-Jenkins-Project/blob/c5593aca5beec5604330712470f9cb0a83b1e18f/Pipeline)

### Setup CI/CD with Jenkins, Git, Maven and Tomcat

- Setup Jenkins
- Write pieline script
- Setup & configure Maven and Git
- Setup Tomcat Server
- Installing additional required plugins
- Integrating Git, Maven in Jenkins job
- Run CI/CD job

<details>
  <summary>Architecture</summary>
  <img src="./docs/1.png"/>
</details>

### Integrate Ansible with Jenkins

- Go into the jenkins control > `manage jenkins` > `configure system`
- similar to docker host in publish over SSH add a new config
  - `Name` : `ansible-server`
  - `Hostname`: give the ip address of ansible host `ip addr` without `/32`
  - `username`: `ansadmin`
  - `Advance` > use password authentication checkbox
  - `password`: `give the ansadmin password` and test configuration
  - `apply` > `save`
- Create a job > `deploy_on_container_using_ansible` > copy from: `deploy_on_container`
  - Enable `PollSCM` > `* * * * *`
  - SSH Name: `ansible-server`
  - Remote directory: `//opt/docker`
  - Exec command: ``
- `Build now`

## Integrating Ansible in pipeline

Now we will integrate ansible to the pipeline, so we can deploy on servers.

### Create an Ansible playbook to deploy application on servers

- Writing a Ansible playbook to deploy on servers

```yaml
---
- hosts: all
  tasks:

    - name: task1
      copy:
        src: /var/lib/jenkins/workspace/pipeline/target/NETFLIX-1.2.2.war
        dest: /root/tomcat/webapps
...
```

### Integrate Tomcat server with Jenkins

- We need to integrate tomcat server with jenkins for deployment.
- Go to the jenkins serve and to install on vm we need an additional plugin called `deploy to container`. So we need to install it.
- Since we need to deploy it once successful, we need to add `post-build action` > `deploy war/ear to a container`  > give the war file location > `**/*.war`
- Select `add to container` > `tomcat v8` > to deploy to tomcat server it should accept jenkins credentials. Since we created couple of users we can use those users.
- Give the `deployer` credential and add the tomcat url `http://x.xx.xx.x:8080/` > Apply > Save
- Run the job by pressing `Build now`.
- So now when we run this job it will deploy the war file to tomcat server. The jenkins will copy the files to `/opt/tomcat/webapps/` directory.
- To access the application we need to give the war file name. i.e. `http://x.xx.xx.x:8080/webapp`

## What is CI/CD ?

- Continuos Integration (CI) - It refers to Build + Test. As a result .war file will be generated.
- Continuos Delivery (CD) - There will be a manual intervention to deploy to env
- Continuos Deployment (CD) - No manual intervention
- CI process with result in an artifact which is used in the staging env.

<details>
  <summary>CI/CD Architecture</summary>
  <img src="./docs/5.png"/>
</details>

- If this whole process happens without any manual intervention then its continuos deployment.
  
<details>
  <summary>Continuous deployment Architecture</summary>
  
  <img src="./docs/6.png"/>
  <img src="./docs/7.png"/>
</details>

### Artifact storage
- The source code which undergoes build and test is found at [source code](https://github.com/Lakshmi1799/Devops-Jenkins-Project/tree/c5593aca5beec5604330712470f9cb0a83b1e18f/java)
- The generated .war/.jar file(artifact) are stored in S3 bucket or in JFrog artifactory.
- In the current project, artifact is stored in S3 bucket.

## Jenkins Deploy on EC2/VM

- Jenkins pulls the code from git and deploys the code to EC2 instance running tomcat.

<details>
  <summary>EC2 Architecture</summary>
  <img src="./docs/9.png"/>
</details>


### Automatic Deploy on Code change

> How to automatically trigger a new build on code change ?

- In the pipeline job,
- Scroll down and then `Build trigger` section, if we specify `build periodically` then we need to add a cron job.
- `PollSCM` also is like cron job where it will fetch the repository periodically. If there wasnt any changes during that period of time, then it wont trigger that job. `* * * * *` - every minute, every hour, every day, every week, every month it should get executed. If you need to execute once a day around 12'o clock `00 12 * * *`
- Now if we push a code change, it will be automatically triggered.
- Here we are using jenkins as build and deployment tool.


### Limitation of Jenkins as Deployment tool

> Use `ansible` as deployment tool while `jenkins` as build tool.

- Jenkins cant be used as a full-fledged deployment tools for example if the war file is already available then the file is going to fail.
- So to overcome these problems we're going to use `ansible` as our deployment tool.
- If you have 100s of deployment location then its a difficult task for jenkins. These kind of problem are hectic to handle with jenkins.
- Hence we're only going to use jenkins as a `build tool` not a deployment tool.



